{% extends 'base/base.html' %}
{% load static %}

{% block title %}Review Details - Hotel Review Insight Platform{% endblock %}

{% block page_icon %}<i class="fas fa-comment-alt"></i>{% endblock %}
{% block page_title %}Review Details{% endblock %}

{% block page_description %}
<p class="text-muted mb-0">Detailed analysis of individual review</p>
{% endblock %}

{% block page_actions %}
<a href="{% url 'dashboard:home' %}" class="btn btn-outline-secondary">
    <i class="fas fa-arrow-left me-1"></i>Back to Dashboard
</a>
{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
    <div class="row">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-comment me-2"></i>Review Content
                    </h5>
                </div>
            <div class="card-body">
                {% if review.title %}
                    <h6 class="mb-3">{{ review.title }}</h6>
                {% endif %}
                
                <p class="lead">{{ review.text }}</p>
                
                <div class="row mt-4">
                    <div class="col-md-6">
                        <h6>Sentiment Analysis</h6>
                        <span class="badge bg-{% if review.sentiment == 'positive' %}success{% elif review.sentiment == 'negative' %}danger{% else %}warning{% endif %} fs-6">
                            {{ review.sentiment|title }}
                        </span>
                        <small class="text-muted ms-2">
                            Confidence: {{ review.confidence_score|floatformat:1 }}
                        </small>
                    </div>
                    
                    <div class="col-md-6">
                        <h6>AI Score</h6>
                        <div class="d-flex align-items-center">
                            <span class="me-2 fs-5">{{ review.ai_score|floatformat:1 }}/5</span>
                            <div class="progress flex-grow-1" style="height: 20px;">
                                <div class="progress-bar review-score-bar" 
                                     data-score="{{ review.ai_score|floatformat:1 }}"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-info-circle me-2"></i>Review Information
                </h5>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <strong>Hotel:</strong><br>
                    <a href="#" class="text-decoration-none">{{ review.hotel.name }}</a><br>
                    <small class="text-muted">{{ review.hotel.location }}</small>
                </div>
                
                {% if review.reviewer_name %}
                <div class="mb-3">
                    <strong>Reviewer:</strong><br>
                    {{ review.reviewer_name }}
                    {% if review.reviewer_location %}
                        <br><small class="text-muted">{{ review.reviewer_location }}</small>
                    {% endif %}
                </div>
                {% endif %}
                
                <div class="mb-3">
                    <strong>Source:</strong><br>
                    {{ review.source.name }}
                </div>
                
                {% if review.original_rating %}
                <div class="mb-3">
                    <strong>Original Rating:</strong><br>
                    {{ review.original_rating }}/5
                </div>
                {% endif %}
                
                <div class="mb-3">
                    <strong>Posted:</strong><br>
                    {% if review.date_posted %}
                        {{ review.date_posted|date:"F d, Y" }}
                    {% else %}
                        {{ review.created_at|date:"F d, Y" }}
                    {% endif %}
                </div>
                
                <div class="mb-3">
                    <strong>Processing Status:</strong><br>
                    <span class="badge bg-{% if review.processed %}success{% else %}warning{% endif %}">
                        {% if review.processed %}Processed{% else %}Pending{% endif %}
                    </span>
                </div>
            </div>
        </div>
        
        <!-- Quick Actions -->
        <div class="card mt-3">
            <div class="card-header">
                <h6 class="card-title mb-0">Quick Actions</h6>
            </div>
            <div class="card-body">
                <div class="d-grid gap-2">
                    <button class="btn btn-outline-primary btn-sm">
                        <i class="fas fa-edit me-1"></i>Edit Review
                    </button>
                    <button class="btn btn-outline-warning btn-sm">
                        <i class="fas fa-redo me-1"></i>Reprocess
                    </button>
                    <button class="btn btn-outline-danger btn-sm">
                        <i class="fas fa-trash me-1"></i>Delete
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Initialize progress bar when page loads
document.addEventListener('DOMContentLoaded', function() {
    initializeReviewScoreBar();
});

function initializeReviewScoreBar() {
    const progressBar = document.querySelector('.review-score-bar');
    if (progressBar) {
        const score = parseFloat(progressBar.dataset.score) || 0;
        const percentage = Math.round((score / 5) * 100);
        progressBar.style.width = percentage + '%';
        
        // Add color based on score
        if (score >= 4) {
            progressBar.classList.add('bg-success');
        } else if (score >= 3) {
            progressBar.classList.add('bg-warning');
        } else {
            progressBar.classList.add('bg-danger');
        }
    }
}
</script>
{% endblock %}
